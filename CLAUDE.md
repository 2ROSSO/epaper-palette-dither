# CLAUDE.md — 開発ルール・規約

## ドキュメント参照
- 各種ライブラリやツールの使用前には、必ず公式ドキュメントを参照すること
- 公式ドキュメントの情報に基づいて実装し、非公式の情報のみに依存しない
- 使用するライブラリの対象バージョンに対応したドキュメントを参照すること

## パッケージ管理
- **uv** を使用してプロジェクト・依存関係を管理する
- `uv add` で依存追加、`uv run` でスクリプト実行
- `uv.lock` はコミット対象に含める

## ブランチ戦略
- **`wip/<feature>`**: 実装作業ブランチ。細切れにコミットしセーブポイントを増やす
- **`pr/<feature>`**: PR用クリーンブランチ。wip完了後に機能単位の段階的コミットで再構成
- wip/ブランチ完成時（pr/ブランチ作成直前）にテスト全通過を必須とする
- pr/ブランチの各コミットもテスト通過を必須条件とする

## コミットルール
- wip/: 頻繁に小さくコミット（セーブポイント重視）
- pr/: PRを前提とした機能単位の段階的コミット
- **wipブランチ完成時（pr/ブランチ作成直前）にテスト全通過を必須とする**
- pr/ブランチの各コミット前にもテスト実行を必須とする

## テスト
- 機能実装時は必ずテストファイルを生成する
- wipブランチ完成時にテスト全通過を必須とする（pr/ブランチ作成のゲート条件）
- pr/ブランチでの各コミットでもテスト通過を条件とする
- `uv run pytest` でテスト実行

## コード設計
- クリーンアーキテクチャの原則に従う（domain / application / infrastructure / presentation）
- DI（依存性注入）を活用し、テスタビリティと拡張性を確保
- 機能実装後、サブ機能・サブ処理のヘルパー関数外出しを検討する
- 定期的に各機能の共通処理を `common` として抽出できないか検討する

## プランニング
- 機能実装の際は plan モードを必須とする
- GUIや3次元的な機能の指示出し時は、プラン段階でアスキーアートによる概略図を提示する

## ドキュメント・プロジェクト管理
- pr/ブランチ完了ごとに README.md および CLAUDE.md を更新する
- 機能追加依頼はタスク分解し、GitHub Issue として登録する
- 機能の優先順位は GitHub Projects（カンバン）で管理する

## プロジェクト構成
```
src/four_color_dither/
├── domain/          # ドメイン層（Pure Python、外部依存なし）
├── application/     # アプリケーション層（ユースケース）
├── infrastructure/  # インフラ層（Pillow, NumPy, ファイルI/O）
└── presentation/    # プレゼンテーション層（PyQt6 GUI）
```

## コマンド
- テスト実行: `uv run pytest`
- アプリ起動: `uv run python -m four_color_dither`
